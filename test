-- NEXA Improved Script - Anti-Cheat Bypass Version
-- Features: Tween Teleport (bypasses instant TP detection), State-Based Noclip, Fly Mode

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

-- Variables
local player = Players.LocalPlayer
local basePosition = Vector3.new(0, 50, 0)
local isNoclipEnabled = false
local isTeleportEnabled = false
local isFlyEnabled = false
local noclipConnection = nil
local flyConnection = nil
local flySpeed = 50
local autoTPInterval = 8 -- seconds between auto TPs (longer = safer)

-- Fly variables
local flyBodyGyro = nil
local flyBodyVelocity = nil

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- GUI CREATION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function createGui()
    local playerGui = player:WaitForChild("PlayerGui")
    
    -- Remove old GUI if exists
    if playerGui:FindFirstChild("NexaImproved") then
        playerGui:FindFirstChild("NexaImproved"):Destroy()
    end
    
    -- Create ScreenGui
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "NexaImproved"
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.Parent = playerGui
    
    -- Main Frame
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0, 240, 0, 380)
    mainFrame.Position = UDim2.new(0.5, -120, 0.1, 0)
    mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = screenGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = mainFrame
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(0, 255, 136)
    stroke.Thickness = 2
    stroke.Parent = mainFrame
    
    -- Title Bar
    local titleBar = Instance.new("Frame")
    titleBar.Name = "TitleBar"
    titleBar.Size = UDim2.new(1, 0, 0, 40)
    titleBar.BackgroundColor3 = Color3.fromRGB(0, 255, 136)
    titleBar.BorderSizePixel = 0
    titleBar.Parent = mainFrame
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 12)
    titleCorner.Parent = titleBar
    
    -- Fix bottom corners of title
    local titleFix = Instance.new("Frame")
    titleFix.Size = UDim2.new(1, 0, 0, 15)
    titleFix.Position = UDim2.new(0, 0, 1, -15)
    titleFix.BackgroundColor3 = Color3.fromRGB(0, 255, 136)
    titleFix.BorderSizePixel = 0
    titleFix.Parent = titleBar
    
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 1, 0)
    title.BackgroundTransparency = 1
    title.Text = "âš¡ NEXA PRO"
    title.Font = Enum.Font.GothamBlack
    title.TextSize = 18
    title.TextColor3 = Color3.fromRGB(15, 15, 20)
    title.Parent = titleBar
    
    -- Status indicator
    local statusLabel = Instance.new("TextLabel")
    statusLabel.Name = "StatusLabel"
    statusLabel.Size = UDim2.new(1, -20, 0, 20)
    statusLabel.Position = UDim2.new(0, 10, 0, 48)
    statusLabel.BackgroundTransparency = 1
    statusLabel.Text = "ğŸŸ¢ Ready - Anti-Cheat Bypass Active"
    statusLabel.Font = Enum.Font.Gotham
    statusLabel.TextSize = 10
    statusLabel.TextColor3 = Color3.fromRGB(0, 255, 136)
    statusLabel.TextXAlignment = Enum.TextXAlignment.Left
    statusLabel.Parent = mainFrame
    
    -- Button creation helper
    local function createButton(name, text, yPos, color)
        local btn = Instance.new("TextButton")
        btn.Name = name
        btn.Size = UDim2.new(0, 215, 0, 38)
        btn.Position = UDim2.new(0, 12, 0, yPos)
        btn.BackgroundColor3 = color or Color3.fromRGB(45, 45, 55)
        btn.Text = text
        btn.Font = Enum.Font.GothamBold
        btn.TextSize = 13
        btn.TextColor3 = Color3.fromRGB(255, 255, 255)
        btn.AutoButtonColor = true
        btn.Parent = mainFrame
        
        local btnCorner = Instance.new("UICorner")
        btnCorner.CornerRadius = UDim.new(0, 8)
        btnCorner.Parent = btn
        
        return btn
    end
    
    -- Buttons
    local noclipBtn = createButton("NoclipBtn", "ğŸ‘» Noclip: OFF", 75)
    local flyBtn = createButton("FlyBtn", "ğŸš€ Fly: OFF", 120)
    local tweenTPBtn = createButton("TweenTPBtn", "ğŸŒ€ Smooth TP: OFF", 165)
    local saveBtn = createButton("SaveBtn", "ğŸ’¾ Save Position", 215, Color3.fromRGB(255, 140, 0))
    local tpNowBtn = createButton("TPNowBtn", "ğŸ“ TP to Saved (Smooth)", 258, Color3.fromRGB(31, 111, 235))
    local instantTPBtn = createButton("InstantTPBtn", "âš¡ Instant TP (Risky)", 301, Color3.fromRGB(180, 60, 60))
    
    -- Position display
    local posDisplay = Instance.new("TextLabel")
    posDisplay.Name = "PosDisplay"
    posDisplay.Size = UDim2.new(1, -20, 0, 20)
    posDisplay.Position = UDim2.new(0, 10, 0, 345)
    posDisplay.BackgroundTransparency = 1
    posDisplay.Text = "No position saved"
    posDisplay.Font = Enum.Font.Gotham
    posDisplay.TextSize = 10
    posDisplay.TextColor3 = Color3.fromRGB(120, 120, 130)
    posDisplay.Parent = mainFrame
    
    -- Speed slider label
    local speedLabel = Instance.new("TextLabel")
    speedLabel.Name = "SpeedLabel"
    speedLabel.Size = UDim2.new(1, -20, 0, 15)
    speedLabel.Position = UDim2.new(0, 10, 0, 362)
    speedLabel.BackgroundTransparency = 1
    speedLabel.Text = "Fly Speed: 50 | Press Q/E to adjust"
    speedLabel.Font = Enum.Font.Gotham
    speedLabel.TextSize = 9
    speedLabel.TextColor3 = Color3.fromRGB(100, 100, 110)
    speedLabel.Parent = mainFrame
    
    -- Make draggable
    local dragging = false
    local dragInput, mousePos, framePos
    
    titleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            mousePos = input.Position
            framePos = mainFrame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    titleBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - mousePos
            mainFrame.Position = UDim2.new(
                framePos.X.Scale,
                framePos.X.Offset + delta.X,
                framePos.Y.Scale,
                framePos.Y.Offset + delta.Y
            )
        end
    end)
    
    return {
        noclipBtn = noclipBtn,
        flyBtn = flyBtn,
        tweenTPBtn = tweenTPBtn,
        saveBtn = saveBtn,
        tpNowBtn = tpNowBtn,
        instantTPBtn = instantTPBtn,
        posDisplay = posDisplay,
        statusLabel = statusLabel,
        speedLabel = speedLabel
    }
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- NOCLIP - Uses Humanoid State Method (Harder to detect)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function setNoclip(enabled, statusLabel)
    if enabled then
        noclipConnection = RunService.Stepped:Connect(function()
            pcall(function()
                local character = player.Character
                if character then
                    local humanoid = character:FindFirstChildOfClass("Humanoid")
                    if humanoid then
                        -- State 11 = StrafingNoPhysics - bypasses most anti-cheats
                        humanoid:ChangeState(11)
                    end
                end
            end)
        end)
        if statusLabel then
            statusLabel.Text = "ğŸ‘» Noclip Active - Walk through walls!"
            statusLabel.TextColor3 = Color3.fromRGB(255, 200, 0)
        end
        print("âœ“ Noclip ENABLED (State Method)")
    else
        if noclipConnection then
            noclipConnection:Disconnect()
            noclipConnection = nil
        end
        pcall(function()
            local character = player.Character
            if character then
                local humanoid = character:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    humanoid:ChangeState(Enum.HumanoidStateType.Running)
                end
            end
        end)
        if statusLabel then
            statusLabel.Text = "ğŸŸ¢ Ready - Anti-Cheat Bypass Active"
            statusLabel.TextColor3 = Color3.fromRGB(0, 255, 136)
        end
        print("âœ“ Noclip DISABLED")
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- FLY MODE - Uses BodyVelocity & BodyGyro
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function setFly(enabled, statusLabel)
    local character = player.Character
    if not character then return end
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoidRootPart or not humanoid then return end
    
    if enabled then
        -- Create BodyGyro for rotation stability
        flyBodyGyro = Instance.new("BodyGyro")
        flyBodyGyro.P = 9e4
        flyBodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
        flyBodyGyro.CFrame = humanoidRootPart.CFrame
        flyBodyGyro.Parent = humanoidRootPart
        
        -- Create BodyVelocity for movement
        flyBodyVelocity = Instance.new("BodyVelocity")
        flyBodyVelocity.Velocity = Vector3.new(0, 0, 0)
        flyBodyVelocity.MaxForce = Vector3.new(9e9, 9e9, 9e9)
        flyBodyVelocity.Parent = humanoidRootPart
        
        -- Disable falling
        humanoid.PlatformStand = true
        
        flyConnection = RunService.RenderStepped:Connect(function()
            pcall(function()
                if not flyBodyVelocity or not flyBodyGyro then return end
                
                local camera = workspace.CurrentCamera
                local moveDir = Vector3.new(0, 0, 0)
                
                -- WASD movement
                if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                    moveDir = moveDir + camera.CFrame.LookVector
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                    moveDir = moveDir - camera.CFrame.LookVector
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                    moveDir = moveDir - camera.CFrame.RightVector
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                    moveDir = moveDir + camera.CFrame.RightVector
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                    moveDir = moveDir + Vector3.new(0, 1, 0)
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) or UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
                    moveDir = moveDir - Vector3.new(0, 1, 0)
                end
                
                if moveDir.Magnitude > 0 then
                    moveDir = moveDir.Unit * flySpeed
                end
                
                flyBodyVelocity.Velocity = moveDir
                flyBodyGyro.CFrame = camera.CFrame
            end)
        end)
        
        if statusLabel then
            statusLabel.Text = "ğŸš€ Flying - WASD + Space/Shift"
            statusLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
        end
        print("âœ“ Fly ENABLED")
    else
        if flyConnection then
            flyConnection:Disconnect()
            flyConnection = nil
        end
        
        if flyBodyGyro then
            flyBodyGyro:Destroy()
            flyBodyGyro = nil
        end
        if flyBodyVelocity then
            flyBodyVelocity:Destroy()
            flyBodyVelocity = nil
        end
        
        pcall(function()
            humanoid.PlatformStand = false
        end)
        
        if statusLabel then
            statusLabel.Text = "ğŸŸ¢ Ready - Anti-Cheat Bypass Active"
            statusLabel.TextColor3 = Color3.fromRGB(0, 255, 136)
        end
        print("âœ“ Fly DISABLED")
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- TELEPORT FUNCTIONS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- SMOOTH TELEPORT using TweenService (Bypasses most anti-teleport)
local function smoothTeleport(targetPos, statusLabel)
    pcall(function()
        local character = player.Character
        if not character then return end
        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        if not humanoidRootPart then return end
        
        local distance = (humanoidRootPart.Position - targetPos).Magnitude
        -- Calculate time based on distance (faster for short distances)
        local tweenTime = math.clamp(distance / 100, 1, 8) -- 1-8 seconds
        
        local tweenInfo = TweenInfo.new(
            tweenTime,
            Enum.EasingStyle.Quad,
            Enum.EasingDirection.Out
        )
        
        local targetCFrame = CFrame.new(targetPos)
        local tween = TweenService:Create(humanoidRootPart, tweenInfo, {CFrame = targetCFrame})
        
        if statusLabel then
            statusLabel.Text = "ğŸŒ€ Teleporting... (" .. math.floor(tweenTime) .. "s)"
            statusLabel.TextColor3 = Color3.fromRGB(255, 255, 100)
        end
        
        tween:Play()
        tween.Completed:Connect(function()
            if statusLabel then
                statusLabel.Text = "âœ… Arrived at destination!"
                statusLabel.TextColor3 = Color3.fromRGB(0, 255, 136)
            end
        end)
        
        print("âœ“ Smooth teleporting to:", targetPos, "Time:", tweenTime .. "s")
    end)
end

-- INSTANT TELEPORT (Risky - may trigger anti-cheat)
local function instantTeleport(targetPos, statusLabel)
    pcall(function()
        local character = player.Character
        if not character then return end
        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        if not humanoidRootPart then return end
        
        humanoidRootPart.CFrame = CFrame.new(targetPos)
        
        if statusLabel then
            statusLabel.Text = "âš¡ Instant TP Done (May lag back)"
            statusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        end
        
        print("âœ“ Instant teleported to:", targetPos)
    end)
end

-- Save current position
local function savePosition(posDisplay)
    pcall(function()
        local character = player.Character
        if not character then return end
        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        if not humanoidRootPart then return end
        
        basePosition = humanoidRootPart.Position
        
        local x = math.floor(basePosition.X)
        local y = math.floor(basePosition.Y)
        local z = math.floor(basePosition.Z)
        posDisplay.Text = string.format("ğŸ“ Saved: %d, %d, %d", x, y, z)
        posDisplay.TextColor3 = Color3.fromRGB(0, 255, 136)
        
        print("âœ“ Position saved:", basePosition)
    end)
end

-- Auto-TP loop using smooth teleport
local function startAutoTP(statusLabel)
    spawn(function()
        while isTeleportEnabled do
            smoothTeleport(basePosition, statusLabel)
            wait(autoTPInterval)
        end
    end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- MAIN EXECUTION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
print("âš¡ NEXA PRO - Loading...")
print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")

local ui = createGui()

-- Speed adjustment with Q/E keys
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.Q then
        flySpeed = math.max(10, flySpeed - 10)
        ui.speedLabel.Text = "Fly Speed: " .. flySpeed .. " | Press Q/E to adjust"
        print("Fly speed:", flySpeed)
    elseif input.KeyCode == Enum.KeyCode.E then
        flySpeed = math.min(200, flySpeed + 10)
        ui.speedLabel.Text = "Fly Speed: " .. flySpeed .. " | Press Q/E to adjust"
        print("Fly speed:", flySpeed)
    end
end)

-- Noclip button
ui.noclipBtn.MouseButton1Click:Connect(function()
    isNoclipEnabled = not isNoclipEnabled
    ui.noclipBtn.Text = isNoclipEnabled and "ğŸ‘» Noclip: ON" or "ğŸ‘» Noclip: OFF"
    ui.noclipBtn.BackgroundColor3 = isNoclipEnabled and Color3.fromRGB(0, 200, 100) or Color3.fromRGB(45, 45, 55)
    setNoclip(isNoclipEnabled, ui.statusLabel)
end)

-- Fly button
ui.flyBtn.MouseButton1Click:Connect(function()
    isFlyEnabled = not isFlyEnabled
    ui.flyBtn.Text = isFlyEnabled and "ğŸš€ Fly: ON" or "ğŸš€ Fly: OFF"
    ui.flyBtn.BackgroundColor3 = isFlyEnabled and Color3.fromRGB(0, 200, 100) or Color3.fromRGB(45, 45, 55)
    setFly(isFlyEnabled, ui.statusLabel)
end)

-- Auto smooth TP button
ui.tweenTPBtn.MouseButton1Click:Connect(function()
    isTeleportEnabled = not isTeleportEnabled
    ui.tweenTPBtn.Text = isTeleportEnabled and "ğŸŒ€ Smooth TP: ON" or "ğŸŒ€ Smooth TP: OFF"
    ui.tweenTPBtn.BackgroundColor3 = isTeleportEnabled and Color3.fromRGB(0, 200, 100) or Color3.fromRGB(45, 45, 55)
    
    if isTeleportEnabled then
        startAutoTP(ui.statusLabel)
        print("âœ“ Auto Smooth TP started (every " .. autoTPInterval .. "s)")
    else
        print("âœ“ Auto Smooth TP stopped")
    end
end)

-- Save position button
ui.saveBtn.MouseButton1Click:Connect(function()
    savePosition(ui.posDisplay)
    -- Flash effect
    ui.saveBtn.BackgroundColor3 = Color3.fromRGB(0, 255, 136)
    wait(0.2)
    ui.saveBtn.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
end)

-- TP to saved (smooth)
ui.tpNowBtn.MouseButton1Click:Connect(function()
    smoothTeleport(basePosition, ui.statusLabel)
end)

-- Instant TP (risky)
ui.instantTPBtn.MouseButton1Click:Connect(function()
    instantTeleport(basePosition, ui.statusLabel)
end)

-- Re-enable features on respawn
player.CharacterAdded:Connect(function(character)
    wait(1)
    
    if isNoclipEnabled then
        print("Respawned - re-enabling noclip...")
        setNoclip(false, ui.statusLabel)
        wait(0.1)
        setNoclip(true, ui.statusLabel)
    end
    
    if isFlyEnabled then
        print("Respawned - re-enabling fly...")
        setFly(false, ui.statusLabel)
        wait(0.1)
        setFly(true, ui.statusLabel)
    end
end)

print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
print("âœ… NEXA PRO Loaded Successfully!")
print("")
print("ğŸ“‹ FEATURES:")
print("  ğŸ‘» Noclip - Uses state method (harder to detect)")
print("  ğŸš€ Fly - WASD + Space/Shift to move, Q/E for speed")
print("  ğŸŒ€ Smooth TP - Uses TweenService to bypass detection")
print("  âš¡ Instant TP - Fast but risky")
print("")
print("ğŸ’¡ TIPS:")
print("  - Use SMOOTH TP instead of instant for better bypass")
print("  - If you lag back, try longer tween times")
print("  - Some games have server-side anti-cheat (unbypassable)")
print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")

