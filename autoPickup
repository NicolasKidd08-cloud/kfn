--[[
    Modern Brainrot Hub
    Stolen features from BK's Hub v2.5 but with a cleaner UI
]]

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- Config
local Config = {
    AutoStealEnabled = false,
    AutoStealNearest = false,
    DesyncEnabled = false,
    ESPEnabled = false,
    AntiRagdollEnabled = false,
    FloorStealEnabled = false,
    SpeedBoostEnabled = false,
}

-- DESYNC FLAGS (Stolen from BK's Hub)
local DESYNC_FLAGS = {
    LargeReplicatorEnabled9 = true,
    GameNetDontSendRedundantNumTimes = 1,
    MaxTimestepMultiplierAcceleration = 2147483647,
    InterpolationFrameVelocityThresholdMillionth = 5,
    CheckPVDifferencesForInterpolationMinRotVelThresholdRadsPerSecHundredth = 1,
    TimestepArbiterVelocityCriteriaThresholdTwoDt = 2147483646,
    GameNetPVHeaderLinearVelocityZeroCutoffExponent = -5000,
    TimestepArbiterHumanoidTurningVelThreshold = 1,
    LargeReplicatorSerializeWrite4 = true,
    SimExplicitlyCappedTimestepMultiplier = 2147483646,
    InterpolationFrameRotVelocityThresholdMillionth = 5,
    ServerMaxBandwith = 52,
}

-- GUI Creation
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ModernBrainrotHub"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = PlayerGui

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 400, 0, 500)
MainFrame.Position = UDim2.new(0.5, -200, 0.5, -250)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 12)

local MainStroke = Instance.new("UIStroke")
MainStroke.Color = Color3.fromRGB(138, 43, 226)
MainStroke.Thickness = 2
MainStroke.Parent = MainFrame

-- Title
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -20, 0, 40)
Title.Position = UDim2.new(0, 10, 0, 10)
Title.BackgroundTransparency = 1
Title.Text = "üß† Modern Brainrot Hub"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 20
Title.Font = Enum.Font.GothamBold
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = MainFrame

-- Subtitle
local Subtitle = Instance.new("TextLabel")
Subtitle.Size = UDim2.new(1, -20, 0, 20)
Subtitle.Position = UDim2.new(0, 10, 0, 40)
Subtitle.BackgroundTransparency = 1
Subtitle.Text = "Stolen from BK's Hub | All Features"
Subtitle.TextColor3 = Color3.fromRGB(180, 180, 180)
Subtitle.TextSize = 12
Subtitle.Font = Enum.Font.Gotham
Subtitle.TextXAlignment = Enum.TextXAlignment.Left
Subtitle.Parent = MainFrame

-- Scroll Frame for buttons
local ScrollFrame = Instance.new("ScrollingFrame")
ScrollFrame.Size = UDim2.new(1, -20, 1, -80)
ScrollFrame.Position = UDim2.new(0, 10, 0, 70)
ScrollFrame.BackgroundTransparency = 1
ScrollFrame.BorderSizePixel = 0
ScrollFrame.ScrollBarThickness = 6
ScrollFrame.Parent = MainFrame

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 10)
UIListLayout.Parent = ScrollFrame

-- Helper function to create toggles
local function CreateToggle(name, callback)
    local ToggleFrame = Instance.new("Frame")
    ToggleFrame.Size = UDim2.new(1, 0, 0, 50)
    ToggleFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
    ToggleFrame.BorderSizePixel = 0
    ToggleFrame.Parent = ScrollFrame
    
    Instance.new("UICorner", ToggleFrame).CornerRadius = UDim.new(0, 8)
    
    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(0.7, 0, 1, 0)
    Label.Position = UDim2.new(0, 15, 0, 0)
    Label.BackgroundTransparency = 1
    Label.Text = name
    Label.TextColor3 = Color3.fromRGB(255, 255, 255)
    Label.TextSize = 14
    Label.Font = Enum.Font.GothamBold
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Parent = ToggleFrame
    
    local ToggleBg = Instance.new("Frame")
    ToggleBg.Size = UDim2.new(0, 50, 0, 28)
    ToggleBg.Position = UDim2.new(1, -60, 0.5, -14)
    ToggleBg.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
    ToggleBg.BorderSizePixel = 0
    ToggleBg.Parent = ToggleFrame
    
    Instance.new("UICorner", ToggleBg).CornerRadius = UDim.new(1, 0)
    
    local ToggleCircle = Instance.new("Frame")
    ToggleCircle.Size = UDim2.new(0, 22, 0, 22)
    ToggleCircle.Position = UDim2.new(0, 3, 0.5, -11)
    ToggleCircle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    ToggleCircle.BorderSizePixel = 0
    ToggleCircle.Parent = ToggleBg
    
    Instance.new("UICorner", ToggleCircle).CornerRadius = UDim.new(1, 0)
    
    local Button = Instance.new("TextButton")
    Button.Size = UDim2.new(1, 0, 1, 0)
    Button.BackgroundTransparency = 1
    Button.Text = ""
    Button.Parent = ToggleFrame
    
    local enabled = false
    
    Button.MouseButton1Click:Connect(function()
        enabled = not enabled
        callback(enabled)
        
        TweenService:Create(ToggleBg, TweenInfo.new(0.2), {
            BackgroundColor3 = enabled and Color3.fromRGB(138, 43, 226) or Color3.fromRGB(60, 60, 70)
        }):Play()
        
        TweenService:Create(ToggleCircle, TweenInfo.new(0.2), {
            Position = enabled and UDim2.new(0, 25, 0.5, -11) or UDim2.new(0, 3, 0.5, -11)
        }):Play()
    end)
    
    return ToggleFrame
end

-- Helper function for action buttons
local function CreateButton(name, color, callback)
    local ButtonFrame = Instance.new("TextButton")
    ButtonFrame.Size = UDim2.new(1, 0, 0, 45)
    ButtonFrame.BackgroundColor3 = color
    ButtonFrame.BorderSizePixel = 0
    ButtonFrame.Text = name
    ButtonFrame.TextColor3 = Color3.fromRGB(255, 255, 255)
    ButtonFrame.TextSize = 14
    ButtonFrame.Font = Enum.Font.GothamBold
    ButtonFrame.Parent = ScrollFrame
    
    Instance.new("UICorner", ButtonFrame).CornerRadius = UDim.new(0, 8)
    
    ButtonFrame.MouseButton1Click:Connect(callback)
    
    return ButtonFrame
end

-- ============================================================
-- DESYNC SYSTEM (Stolen from BK's Hub)
-- ============================================================

local function EnableDesync()
    for key, value in pairs(DESYNC_FLAGS) do
        pcall(function()
            setfflag(tostring(key), tostring(value))
        end)
    end
    
    -- Create indicator
    local Indicator = Instance.new("Frame")
    Indicator.Size = UDim2.new(0, 200, 0, 50)
    Indicator.Position = UDim2.new(0.5, -100, 0, 100)
    Indicator.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
    Indicator.BorderSizePixel = 0
    Indicator.Parent = ScreenGui
    
    Instance.new("UICorner", Indicator).CornerRadius = UDim.new(0, 10)
    
    local IndicatorText = Instance.new("TextLabel")
    IndicatorText.Size = UDim2.new(1, 0, 1, 0)
    IndicatorText.BackgroundTransparency = 1
    IndicatorText.Text = "‚ö° DESYNC V3 ACTIVE"
    IndicatorText.TextColor3 = Color3.fromRGB(138, 43, 226)
    IndicatorText.TextSize = 14
    IndicatorText.Font = Enum.Font.GothamBold
    IndicatorText.Parent = Indicator
    
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Desync Enabled";
        Text = "No lagback active";
        Duration = 3;
    })
end

-- ============================================================
-- AUTO STEAL SYSTEM (Stolen from BK's Hub)
-- ============================================================

local PromptCache = {}
local InternalStealCache = {}

local function FindProximityPrompt(animalData)
    if PromptCache[animalData] then
        return PromptCache[animalData]
    end
    
    local plot = workspace.Plots:FindFirstChild(animalData.plot)
    if not plot then return nil end
    
    local podiums = plot:FindFirstChild("AnimalPodiums")
    if not podiums then return nil end
    
    local podium = podiums:FindFirstChild(animalData.slot)
    if not podium then return nil end
    
    local base = podium:FindFirstChild("Base")
    if not base then return nil end
    
    local spawn = base:FindFirstChild("Spawn")
    if not spawn then return nil end
    
    local attach = spawn:FindFirstChild("PromptAttachment")
    if not attach then return nil end
    
    for _, p in ipairs(attach:GetChildren()) do
        if p:IsA("ProximityPrompt") then
            PromptCache[animalData] = p
            return p
        end
    end
    
    return nil
end

local function BuildStealCallbacks(prompt)
    if InternalStealCache[prompt] then return end
    
    local data = {
        holdCallbacks = {},
        triggerCallbacks = {},
        ready = true,
    }
    
    local ok1, conns1 = pcall(getconnections, prompt.PromptButtonHoldBegan)
    if ok1 and type(conns1) == "table" then
        for _, conn in ipairs(conns1) do
            if type(conn.Function) == "function" then
                table.insert(data.holdCallbacks, conn.Function)
            end
        end
    end
    
    local ok2, conns2 = pcall(getconnections, prompt.Triggered)
    if ok2 and type(conns2) == "table" then
        for _, conn in ipairs(conns2) do
            if type(conn.Function) == "function" then
                table.insert(data.triggerCallbacks, conn.Function)
            end
        end
    end
    
    InternalStealCache[prompt] = data
end

local function ExecuteSteal(prompt)
    local data = InternalStealCache[prompt]
    if not data or not data.ready then return false end
    
    data.ready = false
    
    task.spawn(function()
        for _, fn in ipairs(data.holdCallbacks) do
            task.spawn(fn)
        end
        
        task.wait(1.3)
        
        for _, fn in ipairs(data.triggerCallbacks) do
            task.spawn(fn)
        end
        
        task.wait()
        data.ready = true
    end)
    
    return true
end

local AutoStealConnection = nil

local function StartAutoSteal()
    if AutoStealConnection then return end
    
    AutoStealConnection = RunService.Heartbeat:Connect(function()
        if not Config.AutoStealEnabled then return end
        
        -- Find all animals and steal from nearest/best
        -- (Simplified version - full implementation would scan all animals)
        for _, plot in pairs(workspace.Plots:GetChildren()) do
            local podiums = plot:FindFirstChild("AnimalPodiums")
            if podiums then
                for _, podium in pairs(podiums:GetChildren()) do
                    -- Try to find and execute steal
                    local animalData = {plot = plot.Name, slot = podium.Name}
                    local prompt = FindProximityPrompt(animalData)
                    
                    if prompt then
                        BuildStealCallbacks(prompt)
                        ExecuteSteal(prompt)
                    end
                end
            end
        end
    end)
end

local function StopAutoSteal()
    if AutoStealConnection then
        AutoStealConnection:Disconnect()
        AutoStealConnection = nil
    end
end

-- ============================================================
-- SPEED BOOST SYSTEM (Stolen from BK's Hub)
-- ============================================================

local SpeedBoostConnection = nil
local STEAL_SPEED = 25.5

local function StartSpeedBoost()
    if SpeedBoostConnection then return end
    
    SpeedBoostConnection = RunService.Heartbeat:Connect(function()
        if not Config.SpeedBoostEnabled then return end
        if not LocalPlayer:GetAttribute("Stealing") then return end
        
        local char = LocalPlayer.Character
        if not char then return end
        
        local hum = char:FindFirstChildOfClass("Humanoid")
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if not hum or not hrp then return end
        
        local move = hum.MoveDirection
        if move.Magnitude > 0 then
            hrp.AssemblyLinearVelocity = Vector3.new(
                move.X * STEAL_SPEED,
                hrp.AssemblyLinearVelocity.Y,
                move.Z * STEAL_SPEED
            )
        end
    end)
end

local function StopSpeedBoost()
    if SpeedBoostConnection then
        SpeedBoostConnection:Disconnect()
        SpeedBoostConnection = nil
    end
end

-- ============================================================
-- ANTI-RAGDOLL SYSTEM (Stolen from BK's Hub)
-- ============================================================

local AntiRagdollConnection = nil

local function StartAntiRagdoll()
    if AntiRagdollConnection then return end
    
    AntiRagdollConnection = RunService.Heartbeat:Connect(function()
        if not Config.AntiRagdollEnabled then return end
        
        local char = LocalPlayer.Character
        if not char then return end
        
        local hum = char:FindFirstChildOfClass("Humanoid")
        if not hum then return end
        
        -- Check if ragdolled
        local state = hum:GetState()
        if state == Enum.HumanoidStateType.Physics or 
           state == Enum.HumanoidStateType.Ragdoll then
            
            -- Force exit ragdoll
            hum:ChangeState(Enum.HumanoidStateType.Running)
            
            -- Clear ragdoll timer
            pcall(function()
                local now = workspace:GetServerTimeNow()
                LocalPlayer:SetAttribute("RagdollEndTime", now)
            end)
        end
    end)
end

local function StopAntiRagdoll()
    if AntiRagdollConnection then
        AntiRagdollConnection:Disconnect()
        AntiRagdollConnection = nil
    end
end

-- ============================================================
-- FLOOR STEAL SYSTEM (Stolen from BK's Hub)
-- ============================================================

local FloatPlatform = nil

local function StartFloorSteal()
    if FloatPlatform then FloatPlatform:Destroy() end
    
    FloatPlatform = Instance.new("Part")
    FloatPlatform.Size = Vector3.new(6, 1, 6)
    FloatPlatform.Anchored = true
    FloatPlatform.CanCollide = true
    FloatPlatform.Transparency = 1
    FloatPlatform.Parent = workspace
    
    task.spawn(function()
        while Config.FloorStealEnabled and FloatPlatform do
            local char = LocalPlayer.Character
            if char then
                local hrp = char:FindFirstChild("HumanoidRootPart")
                if hrp then
                    FloatPlatform.Position = hrp.Position - Vector3.new(0, 3, 0)
                end
            end
            task.wait(0.05)
        end
    end)
end

local function StopFloorSteal()
    if FloatPlatform then
        FloatPlatform:Destroy()
        FloatPlatform = nil
    end
end

-- ============================================================
-- CREATE GUI ELEMENTS
-- ============================================================

-- Section: Auto Steal
local AutoStealSection = Instance.new("TextLabel")
AutoStealSection.Size = UDim2.new(1, 0, 0, 30)
AutoStealSection.BackgroundTransparency = 1
AutoStealSection.Text = "AUTO STEAL"
AutoStealSection.TextColor3 = Color3.fromRGB(138, 43, 226)
AutoStealSection.TextSize = 16
AutoStealSection.Font = Enum.Font.GothamBold
AutoStealSection.TextXAlignment = Enum.TextXAlignment.Left
AutoStealSection.Parent = ScrollFrame

CreateToggle("Auto-Steal Highest", function(enabled)
    Config.AutoStealEnabled = enabled
    if enabled then
        StartAutoSteal()
    else
        StopAutoSteal()
    end
end)

CreateToggle("Speed Boost During Steal", function(enabled)
    Config.SpeedBoostEnabled = enabled
    if enabled then
        StartSpeedBoost()
    else
        StopSpeedBoost()
    end
end)

-- Section: Movement
local MovementSection = Instance.new("TextLabel")
MovementSection.Size = UDim2.new(1, 0, 0, 30)
MovementSection.BackgroundTransparency = 1
MovementSection.Text = "MOVEMENT"
MovementSection.TextColor3 = Color3.fromRGB(138, 43, 226)
MovementSection.TextSize = 16
MovementSection.Font = Enum.Font.GothamBold
MovementSection.TextXAlignment = Enum.TextXAlignment.Left
MovementSection.Parent = ScrollFrame

CreateToggle("Floor Steal", function(enabled)
    Config.FloorStealEnabled = enabled
    if enabled then
        StartFloorSteal()
    else
        StopFloorSteal()
    end
end)

-- Section: Protection
local ProtectionSection = Instance.new("TextLabel")
ProtectionSection.Size = UDim2.new(1, 0, 0, 30)
ProtectionSection.BackgroundTransparency = 1
ProtectionSection.Text = "PROTECTION"
ProtectionSection.TextColor3 = Color3.fromRGB(138, 43, 226)
ProtectionSection.TextSize = 16
ProtectionSection.Font = Enum.Font.GothamBold
ProtectionSection.TextXAlignment = Enum.TextXAlignment.Left
ProtectionSection.Parent = ScrollFrame

CreateToggle("Anti-Ragdoll", function(enabled)
    Config.AntiRagdollEnabled = enabled
    if enabled then
        StartAntiRagdoll()
    else
        StopAntiRagdoll()
    end
end)

-- Section: Actions
local ActionsSection = Instance.new("TextLabel")
ActionsSection.Size = UDim2.new(1, 0, 0, 30)
ActionsSection.BackgroundTransparency = 1
ActionsSection.Text = "ACTIONS"
ActionsSection.TextColor3 = Color3.fromRGB(138, 43, 226)
ActionsSection.TextSize = 16
ActionsSection.Font = Enum.Font.GothamBold
ActionsSection.TextXAlignment = Enum.TextXAlignment.Left
ActionsSection.Parent = ScrollFrame

CreateButton("‚ö° Enable Desync V3", Color3.fromRGB(138, 43, 226), function()
    EnableDesync()
end)

CreateButton("üîÑ Rejoin Server", Color3.fromRGB(0, 150, 255), function()
    game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, game.JobId, LocalPlayer)
end)

CreateButton("‚ùå Kick Self", Color3.fromRGB(255, 60, 60), function()
    LocalPlayer:Kick("Kicked by user")
end)

-- Update canvas size
UIListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, UIListLayout.AbsoluteContentSize.Y + 10)
end)

-- Startup notification
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "Modern Brainrot Hub";
    Text = "Loaded successfully! All features stolen from BK's Hub";
    Duration = 5;
})

print("üß† Modern Brainrot Hub loaded!")
